#compdef gemini

_gemini() {
    local context state state_descr line
    typeset -A opt_args

    _arguments -S \
        {-d,--debug}'[Run in debug mode?]' \
        {-m,--model}'[Model]:model' \
        {-p,--prompt}'[Prompt (deprecated)]:prompt' \
        {-i,--prompt-interactive}'[Execute the provided prompt and continue in interactive mode]:prompt' \
        {-s,--sandbox}'[Run in sandbox?]' \
        {-y,--yolo}'[Automatically accept all actions (YOLO mode)]' \
        '--approval-mode[Set the approval mode]:mode:(default auto_edit yolo)' \
        '--experimental-acp[Starts the agent in ACP mode]' \
        '*--allowed-mcp-server-names[Allowed MCP server names]:server name' \
        '*--allowed-tools[Tools that are allowed to run without confirmation]:tool' \
        '*-e[A list of extensions to use]:extension' \
        '*--extensions[A list of extensions to use]:extension' \
        {-l,--list-extensions}'[List all available extensions and exit]' \
        {-r,--resume}'[Resume a previous session]:session:(latest)' \
        '--list-sessions[List available sessions for the current project and exit]' \
        '--delete-session[Delete a session by index number]:session index' \
        '*--include-directories[Additional directories to include in the workspace]:directory:_files -/' \
        '--screen-reader[Enable screen reader mode for accessibility]' \
        {-o,--output-format}'[The format of the CLI output]:format:(text json stream-json)' \
        {-v,--version}'[Show version number]' \
        {-h,--help}'[Show help]' \
        '1: :_gemini_commands' \
        '*:: :->args'

    case $state in
        args)
            if [[ $line[1] == (mcp|extensions|extension|hooks|hook) ]]; then
                _gemini_${line[1]}
            else
                _message "query"
            fi
            ;;
    esac
}

_gemini_commands() {
    local -a commands
    commands=(
        "mcp:Manage MCP servers"
        "extensions:Manage Gemini CLI extensions"
        "extension:Manage Gemini CLI extensions (alias)"
        "hooks:Manage Gemini CLI hooks"
        "hook:Manage Gemini CLI hooks (alias)"
    )
    _describe -t commands 'command' commands
}

_gemini_mcp() {
    local context state state_descr line
    typeset -A opt_args

    _arguments -S \
        {-d,--debug}'[Run in debug mode?]' \
        {-h,--help}'[Show help]' \
        '1: :_gemini_mcp_commands' \
        '*:: :->args'

    case $state in
        args)
            _gemini_mcp_${line[1]}
            ;;
    esac
}

_gemini_mcp_commands() {
    local -a commands
    commands=(
        "add:Add a server"
        "remove:Remove a server"
        "list:List all configured MCP servers"
    )
    _describe -t commands 'gemini mcp command' commands
}

_gemini_mcp_add() {
    _arguments -S \
        {-d,--debug}'[Run in debug mode?]' \
        {-s,--scope}'[Configuration scope]:scope:(user project)' \
        {-t,--transport,--type}'[Transport type]:transport:(stdio sse http)' \
        '*-e[Set environment variables (e.g. -e KEY=value)]:env var' \
        '*-H[Set HTTP headers]:header' \
        '--header[Set HTTP headers]:header' \
        '--timeout[Set connection timeout in milliseconds]:milliseconds' \
        '--trust[Trust the server (bypass all tool call confirmation prompts)]' \
        '--description[Set the description for the server]:description' \
        '*--include-tools[Tools to include]:tools' \
        '*--exclude-tools[Tools to exclude]:tools' \
        {-h,--help}'[Show help]' \
        '1:name: ' \
        '2:commandOrUrl: ' \
        '*:args: '
}

_gemini_mcp_remove() {
    _arguments -S \
        {-d,--debug}'[Run in debug mode?]' \
        {-s,--scope}'[Configuration scope]:scope:(user project)' \
        {-h,--help}'[Show help]' \
        '1:name: '
}

_gemini_mcp_list() {
    _arguments -S \
        {-d,--debug}'[Run in debug mode?]' \
        {-h,--help}'[Show help]'
}

_gemini_extensions() {
    local context state state_descr line
    typeset -A opt_args

    _arguments -S \
        {-d,--debug}'[Run in debug mode?]' \
        {-h,--help}'[Show help]' \
        '1: :_gemini_extensions_commands' \
        '*:: :->args'

    case $state in
        args)
            _gemini_extensions_${line[1]}
            ;;
    esac
}

_gemini_extension() {
    _gemini_extensions "$@"
}

_gemini_extensions_commands() {
    local -a commands
    commands=(
        "install:Installs an extension"
        "uninstall:Uninstalls one or more extensions"
        "list:Lists installed extensions"
        "update:Updates extensions"
        "disable:Disables an extension"
        "enable:Enables an extension"
        "link:Links an extension from a local path"
        "new:Create a new extension from a boilerplate example"
        "validate:Validates an extension from a local path"
        "config:Configure extension settings"
    )
    _describe -t commands 'gemini extension command' commands
}

_gemini_extensions_install() {
    _arguments -S \
        {-d,--debug}'[Run in debug mode?]' \
        '--ref[The git ref to install from]:ref' \
        '--auto-update[Enable auto-update for this extension]' \
        '--pre-release[Enable pre-release versions for this extension]' \
        '--consent[Acknowledge security risks]' \
        {-h,--help}'[Show help]' \
        '1:source:_files'
}

_gemini_extensions_uninstall() {
    _arguments -S \
        {-d,--debug}'[Run in debug mode?]' \
        {-h,--help}'[Show help]' \
        '*:names: '
}

_gemini_extensions_list() {
    _arguments -S \
        {-d,--debug}'[Run in debug mode?]' \
        {-h,--help}'[Show help]'
}

_gemini_extensions_update() {
    _arguments -S \
        {-d,--debug}'[Run in debug mode?]' \
        '--all[Update all extensions]' \
        {-h,--help}'[Show help]' \
        '1:name: '
}

_gemini_extensions_disable() {
    _arguments -S \
        {-d,--debug}'[Run in debug mode?]' \
        '--scope[The scope to disable the extension in]:scope' \
        {-h,--help}'[Show help]' \
        '1:name: '
}

_gemini_extensions_enable() {
    _arguments -S \
        {-d,--debug}'[Run in debug mode?]' \
        '--scope[The scope to enable the extension in]:scope' \
        {-h,--help}'[Show help]' \
        '1:name: '
}

_gemini_extensions_link() {
    _arguments -S \
        {-d,--debug}'[Run in debug mode?]' \
        '--consent[Acknowledge security risks]' \
        {-h,--help}'[Show help]' \
        '1:path:_files -/'
}

_gemini_extensions_new() {
    _arguments -S \
        {-d,--debug}'[Run in debug mode?]' \
        {-h,--help}'[Show help]' \
        '1:path:_files -/' \
        '2:template:(context custom-commands exclude-tools mcp-server)'
}

_gemini_extensions_validate() {
    _arguments -S \
        {-d,--debug}'[Run in debug mode?]' \
        {-h,--help}'[Show
