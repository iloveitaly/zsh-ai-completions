#compdef gemini

function _gemini {
  local context state state_descr line
  typeset -A opt_args

  _arguments -S \
    '(-d --debug)'{-d,--debug}'[Run in debug mode]' \
    '(-m --model)'{-m,--model}'[Model]:model' \
    '(-p --prompt)'{-p,--prompt}'[Prompt (deprecated)]:prompt' \
    '(-i --prompt-interactive)'{-i,--prompt-interactive}'[Execute the provided prompt and continue in interactive mode]:prompt' \
    '(-s --sandbox)'{-s,--sandbox}'[Run in sandbox]' \
    '(-y --yolo)'{-y,--yolo}'[Automatically accept all actions]' \
    '--approval-mode[Set the approval mode]:mode:(default auto_edit yolo)' \
    '--experimental-acp[Starts the agent in ACP mode]' \
    '*--allowed-mcp-server-names[Allowed MCP server names]:server_name' \
    '*--allowed-tools[Tools that are allowed to run without confirmation]:tool' \
    '*'{-e,--extensions}'[A list of extensions to use]:extension' \
    '(-l --list-extensions)'{-l,--list-extensions}'[List all available extensions and exit]' \
    '(-r --resume)'{-r,--resume}'[Resume a previous session]:session:(latest)' \
    '--list-sessions[List available sessions for the current project and exit]' \
    '--delete-session[Delete a session by index number]:session_index' \
    '*--include-directories[Additional directories to include]:directory:_files -/' \
    '--screen-reader[Enable screen reader mode for accessibility]' \
    '(-o --output-format)'{-o,--output-format}'[The format of the CLI output]:format:(text json stream-json)' \
    '(-v --version)'{-v,--version}'[Show version number]' \
    '(-h --help)'{-h,--help}'[Show help]' \
    '1: :_gemini_commands' \
    '*:: :->args' && return 0

  case $state in
    args)
      case $words[1] in
        mcp)
          _gemini_mcp
          ;;
        extensions|extension)
          _gemini_extensions
          ;;
        hooks|hook)
          _gemini_hooks
          ;;
        *)
          _message "query"
          ;;
      esac
      ;;
  esac
}

function _gemini_commands {
  local -a commands
  commands=(
    'mcp:Manage MCP servers'
    'extensions:Manage Gemini CLI extensions'
    'hooks:Manage Gemini CLI hooks'
  )
  _describe -t commands 'command' commands
}

function _gemini_mcp {
  local context state state_descr line
  typeset -A opt_args

  _arguments -S \
    '(-d --debug)'{-d,--debug}'[Run in debug mode]' \
    '(-h --help)'{-h,--help}'[Show help]' \
    '1: :_gemini_mcp_commands' \
    '*:: :->args' && return 0

  case $state in
    args)
      case $words[1] in
        add)
          _gemini_mcp_add
          ;;
        remove)
          _gemini_mcp_remove
          ;;
        list)
          _gemini_mcp_list
          ;;
        *)
          ;;
      esac
      ;;
  esac
}

function _gemini_mcp_commands {
  local -a commands
  commands=(
    'add:Add a server'
    'remove:Remove a server'
    'list:List all configured MCP servers'
  )
  _describe -t commands 'mcp command' commands
}

function _gemini_mcp_add {
  _arguments -S \
    '(-d --debug)'{-d,--debug}'[Run in debug mode]' \
    '(-s --scope)'{-s,--scope}'[Configuration scope]:scope:(user project)' \
    '(-t --transport --type)'{-t,--transport,--type}'[Transport type]:transport:(stdio sse http)' \
    '*'{-e,--env}'[Set environment variables]:env_var' \
    '*'{-H,--header}'[Set HTTP headers for SSE and HTTP transports]:header' \
    '--timeout[Set connection timeout in milliseconds]:ms' \
    '--trust[Trust the server (bypass all tool call confirmation prompts)]' \
    '--description[Set the description for the server]:description' \
    '--include-tools[A comma-separated list of tools to include]:tools' \
    '--exclude-tools[A comma-separated list of tools to exclude]:tools' \
    '(-h --help)'{-h,--help}'[Show help]' \
    '1:name:' \
    '2:command_or_url:' \
    '*:args:'
}

function _gemini_mcp_remove {
  _arguments -S \
    '(-d --debug)'{-d,--debug}'[Run in debug mode]' \
    '(-s --scope)'{-s,--scope}'[Configuration scope]:scope:(user project)' \
    '(-h --help)'{-h,--help}'[Show help]' \
    '1:name:'
}

function _gemini_mcp_list {
  _arguments -S \
    '(-d --debug)'{-d,--debug}'[Run in debug mode]' \
    '(-h --help)'{-h,--help}'[Show help]'
}

function _gemini_extensions {
  local context state state_descr line
  typeset -A opt_args

  _arguments -S \
    '(-d --debug)'{-d,--debug}'[Run in debug mode]' \
    '(-h --help)'{-h,--help}'[Show help]' \
    '1: :_gemini_extensions_commands' \
    '*:: :->args' && return 0

  case $state in
    args)
      case $words[1] in
        install)
          _gemini_extensions_install
          ;;
        uninstall)
          _gemini_extensions_uninstall
          ;;
        list)
          _gemini_extensions_list
          ;;
        update)
          _gemini_extensions_update
          ;;
        disable)
          _gemini_extensions_disable
          ;;
        enable)
          _gemini_extensions_enable
          ;;
        link)
          _gemini_extensions_link
          ;;
        new)
          _gemini_extensions_new
          ;;
        validate)
          _gemini_extensions_validate
          ;;
        config)
          _gemini_extensions_config
          ;;
        *)
          ;;
      esac
      ;;
  esac
}

function _gemini_extensions_commands {
  local -a commands
  commands=(
    'install:Installs an extension from a git repository URL or a local path'
    'uninstall:Uninstalls one or more extensions'
    'list:Lists installed extensions'
    'update:Updates all extensions or a named extension to the latest version'
    'disable:Disables an extension'
    'enable:Enables an extension'
    'link:Links an extension from a local path'
    'new:Create a new extension from a boilerplate example'
    'validate:Validates an extension from a local path'
    'config:Configure extension settings'
  )
  _describe -t commands 'extension command' commands
}

function _gemini_extensions_install {
  _arguments -S \
    '(-d --debug)'{-d,--debug}'[Run in debug mode]' \
    '--ref[The git ref to install from]:git_ref' \
    '--auto-update[Enable auto-update for this extension]' \
    '--pre-release[Enable pre-release versions for this extension]' \
    '--consent[Acknowledge the security risks and skip confirmation]' \
    '(-h --help)'{-h,--help}'[Show help]' \
    '1:source:_files'
}

function _gemini_extensions_uninstall {
  _arguments -S \
    '(-d --debug)'{-d,--debug}'[Run in debug mode]' \
    '(-h --help)'{-h,--help}'[Show help]' \
    '*:name:'
}

function _gemini_extensions_list {
  _arguments -S \
    '(-d --debug)'{-d,--debug}'[Run in debug mode]' \
    '(-h --help)'{-h,--help}'[Show help]'
}

function _gemini_extensions_update {
  _arguments -S \
    '(-d --debug)'{-d,--debug}'[Run in debug mode]' \
    '--all[Update all extensions]' \
    '(-h --help)'{-h,--help}'[Show help]' \
    '1:name:'
}

function _gemini_extensions_disable {
  _arguments -S \
    '(-d --debug)'{-d,--debug}'[Run in debug mode]' \
    '--scope[The scope to disable the extension in]:scope:(User)' \
    '(-h --help)'{-h,--help}'[Show help]' \
    '1:name:'
}

function _gemini_extensions_enable {
  _arguments -S \
    '(-d --debug)'{-d,--debug}'[Run in debug mode]' \
    '--scope[The scope to enable the extension in]:scope' \
    '(-h --help)'{-h,--help}'[Show help]' \
    '1:name:'
}

function _gemini_extensions_link {
  _arguments -S \
    '(-d --debug)'{-d,--debug}'[Run in debug mode]' \
    '--consent[Acknowledge the security risks and skip confirmation]' \
    '(-h --help)'{-h,--help}'[Show help]' \
    '1:path:_files -/'
}

function _gemini_extensions_new {
  _arguments -S \
    '(-d --debug)'{-d,--debug}'[Run in debug mode]' \
    '(-h --help)'{-h,--help}'[Show help]' \
    '1:path:_files -/' \
    '2:template:(context custom-commands exclude-tools mcp-server)'
}

function _gemini_extensions_validate {
  _arguments -S \
    '(-d --debug)'{-d,--debug}'[Run in debug mode]' \
    '(-h --help)'{-h,--help}'[Show help]' \
    '1:path:_files -/'
}

function _gemini_extensions_config {
  _arguments -S \
    '(-d --debug)'{-d,--debug}'[Run in debug mode]' \
    '(-h --help)'{-h,--help}'[Show help]' \
    '1:name:' \
    '2:setting:'
}

function _gemini_hooks {
  local context state state_descr line
  typeset -A opt_args

  _arguments -S \
    '(-d --debug)'{-d,--debug}'[Run in debug mode]' \
    '(-h --help)'{-h,--help}'[Show help]' \
    '1: :_gemini_hooks_commands' \
    '*:: :->args' && return 0

  case $state in
    args)
      case $words[1] in
        migrate)
          _gemini_hooks_migrate
          ;;
        *)
          ;;
      esac
      ;;
  esac
}

function _gemini_hooks_commands {
  local -a commands
  commands=(
    'migrate:Migrate hooks from Claude Code to Gemini CLI'
  )
  _describe -t commands 'hooks command' commands
}

function _gemini_hooks_migrate {
  _arguments -S \
    '(-d --debug)'{-d,--debug}'[Run in debug mode]' \
    '(-h --help)'{-h,--help}'[Show help]'
}

_gemini "$@"